<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        (function () {
            const params = new URLSearchParams(window.location.search);
            const isEmbed = params.get('embed') === '1';
            const isStandalone = params.get('standalone') === '1';
            if (!isEmbed && !isStandalone) {
                window.location.replace('../survey-suite/?view=distribution');
                return;
            }
            if (isEmbed) {
                document.documentElement.classList.add('embed-mode');
            }
        })();
    </script>
    <title>Distribution Lab | RecuEdu Labs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" href="../../assets/css/recuedu.css">
    <link rel="stylesheet" href="../../assets/css/recuedu-topbar.css">
    <link rel="stylesheet" href="style-dashboard.css">
</head>
<body>
    <div class="recuedu-topbar">
        <div class="topbar-container">
            <a href="../../index.html" class="topbar-brand">
                <i class="fa-solid fa-flask-vial"></i>
                <span>RecuEdu Labs</span>
            </a>
            <div class="topbar-links">
                <a href="../../index.html">
                    <i class="fa-solid fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="https://github.com/ravellom" target="_blank">
                    <i class="fa-brands fa-github"></i>
                </a>
            </div>
        </div>
    </div>

    <header class="app-header">
        <div class="brand">
            <i class="ph ph-chart-scatter"></i>
            <div>
                <h1>Distribution Lab <span class="badge">alpha</span></h1>
                <p class="subtitle" data-i18n="subtitle">Advanced boxplot and violin analysis for survey datasets</p>
            </div>
        </div>
        <div class="actions">
            <select id="language-select" class="language-select">
                <option value="en">English</option>
                <option value="es">Espa√±ol</option>
            </select>
        </div>
    </header>

    <div class="dashboard-layout">
        <nav class="nav-sidebar">
            <div class="nav-menu">
                <button class="nav-item active" data-panel="data">
                    <span class="nav-icon"><i class="ph ph-folder-simple"></i></span>
                    <span class="nav-label" data-i18n="nav_data">Data</span>
                </button>
                <button class="nav-item" data-panel="groups">
                    <span class="nav-icon"><i class="ph ph-users-three"></i></span>
                    <span class="nav-label" data-i18n="nav_groups">Groups</span>
                </button>
                <button class="nav-item" data-panel="chart">
                    <span class="nav-icon"><i class="ph ph-chart-line"></i></span>
                    <span class="nav-label" data-i18n="nav_chart">Chart</span>
                </button>
                <button class="nav-item" data-panel="style">
                    <span class="nav-icon"><i class="ph ph-palette"></i></span>
                    <span class="nav-label" data-i18n="nav_style">Style</span>
                </button>
                <button class="nav-item" data-panel="annotations">
                    <span class="nav-icon"><i class="ph ph-note-pencil"></i></span>
                    <span class="nav-label" data-i18n="nav_annotations">Notes</span>
                </button>
                <button class="nav-item" data-panel="export">
                    <span class="nav-icon"><i class="ph ph-download-simple"></i></span>
                    <span class="nav-label" data-i18n="nav_export">Export</span>
                </button>
            </div>
        </nav>

        <main class="chart-main">
            <div class="chart-header">
                <h2 data-i18n="preview_title">Preview</h2>
                <div class="dataset-chip">
                    <span data-i18n="active_dataset">Active dataset</span>:
                    <strong id="active-dataset-name">-</strong>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-placeholder" id="chart-placeholder">
                    <svg class="placeholder-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M4 18h16"></path>
                        <path d="M8 14V8"></path>
                        <path d="M16 16V6"></path>
                        <rect x="6" y="10" width="4" height="6"></rect>
                        <rect x="14" y="8" width="4" height="8"></rect>
                    </svg>
                    <p data-i18n="placeholder">Select a dataset and numeric column to start</p>
                </div>
                <canvas id="chart-canvas" class="hidden"></canvas>
            </div>
        </main>

        <aside class="options-sidebar">
            <div class="options-panel active" id="panel-data">
                <h3 class="options-title" data-i18n="panel_data">Data</h3>
                <div class="option-group">
                    <label class="option-label" data-i18n="dataset_source">Dataset source</label>
                    <input id="dataset-source" class="text-input" value="Survey Suite Active Dataset" readonly>
                </div>
                <div class="option-group">
                    <label class="option-label" data-i18n="numeric_variable">Numeric variable (Y)</label>
                    <select id="numeric-column" class="select-input"></select>
                </div>
                <div class="option-group">
                    <label class="option-label" data-i18n="category_variable">Category variable (X, optional)</label>
                    <select id="category-column" class="select-input"></select>
                </div>
                <div class="option-group">
                    <button id="btn-refresh-dataset" class="btn-primary btn-block">
                        <i class="ph ph-arrow-clockwise"></i> <span data-i18n="refresh_dataset">Refresh Dataset</span>
                    </button>
                </div>
                <div class="option-group">
                    <div id="data-summary" class="data-summary"></div>
                </div>
            </div>

            <div class="options-panel" id="panel-groups">
                <h3 class="options-title" data-i18n="panel_groups">Groups</h3>
                <div class="option-group">
                    <label class="option-label" data-i18n="group_order">Group order</label>
                    <select id="group-order" class="select-input">
                        <option value="original">Original</option>
                        <option value="alphabetical">Alphabetical</option>
                        <option value="median_desc">Median desc</option>
                        <option value="median_asc">Median asc</option>
                    </select>
                </div>
                <div class="option-group">
                    <label class="option-label" data-i18n="top_n_groups">Top N groups</label>
                    <input id="top-n-groups" type="number" min="1" max="100" value="15" class="number-input">
                </div>
            </div>

            <div class="options-panel" id="panel-chart">
                <h3 class="options-title" data-i18n="panel_chart">Chart</h3>
                <details class="settings-section" open>
                    <summary data-i18n="chart_group_basics">Basics</summary>
                    <div class="option-group">
                        <label class="option-label" data-i18n="chart_type">Chart type</label>
                        <select id="chart-type" class="select-input">
                            <option value="boxplot">Boxplot</option>
                            <option value="violin">Violin</option>
                            <option value="boxviolin">Box + Violin</option>
                        </select>
                    </div>
                    <div class="option-group">
                        <label class="option-label" data-i18n="orientation">Orientation</label>
                        <select id="chart-orientation" class="select-input">
                            <option value="horizontal" data-i18n="horizontal">Horizontal</option>
                            <option value="vertical" data-i18n="vertical">Vertical</option>
                        </select>
                    </div>
                </details>
                <details class="settings-section">
                    <summary data-i18n="chart_group_distribution">Distribution Model</summary>
                    <div class="option-group">
                        <label class="option-label" data-i18n="whisker_multiplier">Whisker multiplier (IQR)</label>
                        <input id="whisker-multiplier" type="number" min="0.5" max="4" step="0.1" value="1.5" class="number-input">
                    </div>
                    <div class="option-group">
                        <label class="option-label" data-i18n="kde_bandwidth">KDE bandwidth factor</label>
                        <input id="kde-bandwidth-factor" type="number" min="0.2" max="3" step="0.1" value="1.0" class="number-input">
                    </div>
                    <div class="option-group">
                        <label class="option-label" data-i18n="kde_steps">KDE steps</label>
                        <input id="kde-steps" type="number" min="30" max="200" step="5" value="70" class="number-input">
                    </div>
                </details>
                <details class="settings-section">
                    <summary data-i18n="chart_group_points">Points and Outliers</summary>
                    <div class="option-group">
                        <label class="checkbox-label">
                            <input id="show-outliers" type="checkbox" checked>
                            <span data-i18n="show_outliers">Show outliers</span>
                        </label>
                    </div>
                    <div class="option-group">
                        <label class="checkbox-label">
                            <input id="show-jitter" type="checkbox">
                            <span data-i18n="show_jitter">Show jitter points</span>
                        </label>
                    </div>
                </details>
            </div>

            <div class="options-panel" id="panel-style">
                <h3 class="options-title" data-i18n="panel_style">Style</h3>
                <details class="settings-section" open>
                    <summary data-i18n="style_group_theme">Theme and Typography</summary>
                    <div class="option-group">
                        <label class="option-label" data-i18n="color_scheme">Color scheme</label>
                        <select id="color-scheme" class="select-input">
                            <option value="blue_orange">Blue/Orange</option>
                            <option value="cool">Cool</option>
                            <option value="warm">Warm</option>
                        </select>
                    </div>
                    <div class="option-group">
                        <label class="option-label" data-i18n="font_family">Font family</label>
                        <select id="font-family" class="select-input">
                            <option value="Arial, sans-serif">Arial</option>
                            <option value="'Segoe UI', Tahoma, sans-serif">Segoe UI</option>
                            <option value="Georgia, serif">Georgia</option>
                            <option value="'Courier New', monospace">Courier New</option>
                        </select>
                    </div>
                    <div class="option-group two-col">
                        <div>
                            <label class="option-label" data-i18n="title_size">Title size</label>
                            <input id="title-font-size" type="number" min="12" max="42" value="20" class="number-input">
                        </div>
                        <div>
                            <label class="option-label" data-i18n="label_size">Label size</label>
                            <input id="label-font-size" type="number" min="10" max="24" value="12" class="number-input">
                        </div>
                    </div>
                </details>
                <details class="settings-section">
                    <summary data-i18n="style_group_marks">Marks and Visual Elements</summary>
                    <div class="option-group two-col">
                        <div>
                            <label class="option-label" data-i18n="line_width">Line width</label>
                            <input id="line-width" type="number" min="1" max="5" value="2" class="number-input">
                        </div>
                        <div>
                            <label class="option-label" data-i18n="violin_opacity">Violin opacity</label>
                            <input id="violin-opacity" type="number" min="0.1" max="1" step="0.05" value="0.55" class="number-input">
                        </div>
                    </div>
                    <div class="option-group two-col">
                        <div>
                            <label class="option-label" data-i18n="jitter_size">Jitter size</label>
                            <input id="jitter-size" type="number" min="1" max="6" step="0.2" value="1.6" class="number-input">
                        </div>
                        <div>
                            <label class="option-label" data-i18n="jitter_alpha">Jitter alpha</label>
                            <input id="jitter-alpha" type="number" min="0.1" max="1" step="0.05" value="0.4" class="number-input">
                        </div>
                    </div>
                    <div class="option-group two-col">
                        <div>
                            <label class="option-label" data-i18n="outlier_size">Outlier size</label>
                            <input id="outlier-size" type="number" min="1" max="8" step="0.2" value="2.2" class="number-input">
                        </div>
                        <div>
                            <label class="option-label" data-i18n="outlier_color">Outlier color</label>
                            <input id="outlier-color" type="color" value="#ef4444" class="number-input">
                        </div>
                    </div>
                    <div class="option-group">
                        <label class="checkbox-label">
                            <input id="show-grid" type="checkbox" checked>
                            <span data-i18n="show_grid">Show grid</span>
                        </label>
                    </div>
                </details>
                <details class="settings-section">
                    <summary data-i18n="style_group_layout">Layout and Dimensions</summary>
                    <div class="option-group two-col">
                        <div>
                            <label class="option-label" data-i18n="group_thickness">Group thickness</label>
                            <input id="group-thickness" type="number" min="20" max="80" value="34" class="number-input">
                        </div>
                        <div>
                            <label class="option-label" data-i18n="group_gap">Group gap</label>
                            <input id="group-gap" type="number" min="4" max="40" value="16" class="number-input">
                        </div>
                    </div>
                    <div class="option-group two-col">
                        <div>
                            <label class="option-label" data-i18n="chart_width">Chart width</label>
                            <input id="chart-width" type="number" min="800" max="2600" value="1200" class="number-input">
                        </div>
                        <div>
                            <label class="option-label" data-i18n="chart_height">Chart min height</label>
                            <input id="chart-min-height" type="number" min="360" max="1400" value="420" class="number-input">
                        </div>
                    </div>
                    <div class="option-group two-col">
                        <div>
                            <label class="option-label" data-i18n="margin_left">Margin left</label>
                            <input id="margin-left" type="number" min="80" max="500" value="220" class="number-input">
                        </div>
                        <div>
                            <label class="option-label" data-i18n="margin_right">Margin right</label>
                            <input id="margin-right" type="number" min="40" max="300" value="80" class="number-input">
                        </div>
                    </div>
                    <div class="option-group two-col">
                        <div>
                            <label class="option-label" data-i18n="margin_top">Margin top</label>
                            <input id="margin-top" type="number" min="40" max="220" value="60" class="number-input">
                        </div>
                        <div>
                            <label class="option-label" data-i18n="margin_bottom">Margin bottom</label>
                            <input id="margin-bottom" type="number" min="40" max="220" value="70" class="number-input">
                        </div>
                    </div>
                    <div class="option-group">
                        <label class="option-label" data-i18n="chart_title">Chart title</label>
                        <input id="chart-title-input" class="text-input" placeholder="Distribution analysis">
                    </div>
                </details>
            </div>

            <div class="options-panel" id="panel-annotations">
                <h3 class="options-title" data-i18n="panel_annotations">Annotations</h3>
                <details class="settings-section" open>
                    <summary data-i18n="anno_group_reference">Reference Line</summary>
                    <div class="option-group">
                        <label class="checkbox-label">
                            <input id="show-mean-line" type="checkbox">
                            <span data-i18n="show_mean_line">Show overall mean line</span>
                        </label>
                    </div>
                    <div class="option-group two-col">
                        <div>
                            <label class="option-label" data-i18n="mean_line_color">Mean line color</label>
                            <input id="mean-line-color" type="color" value="#0f172a" class="number-input">
                        </div>
                        <div>
                            <label class="option-label" data-i18n="mean_line_width">Mean line width</label>
                            <input id="mean-line-width" type="number" min="1" max="8" step="0.1" value="1.6" class="number-input">
                        </div>
                    </div>
                    <div class="option-group two-col">
                        <div>
                            <label class="option-label" data-i18n="mean_line_dash">Dash length</label>
                            <input id="mean-line-dash" type="number" min="2" max="40" step="1" value="8" class="number-input">
                        </div>
                        <div>
                            <label class="option-label" data-i18n="mean_line_gap">Dash gap</label>
                            <input id="mean-line-gap" type="number" min="2" max="40" step="1" value="6" class="number-input">
                        </div>
                    </div>
                    <div class="option-group">
                        <label class="checkbox-label">
                            <input id="show-mean-label" type="checkbox" checked>
                            <span data-i18n="show_mean_label">Show mean label</span>
                        </label>
                    </div>
                </details>
                <details class="settings-section">
                    <summary data-i18n="anno_group_stats">Stats Panel</summary>
                    <div class="option-group">
                        <label class="checkbox-label">
                            <input id="show-stats-panel" type="checkbox">
                            <span data-i18n="show_stats_panel">Show stats panel</span>
                        </label>
                    </div>
                    <div class="option-group" id="stats-fields-group">
                        <label class="option-label" data-i18n="stats_fields">Stats fields</label>
                        <div class="option-group two-col">
                            <label class="checkbox-label">
                                <input id="stats-show-n" type="checkbox" checked>
                                <span data-i18n="stat_n">n</span>
                            </label>
                            <label class="checkbox-label">
                                <input id="stats-show-mean" type="checkbox" checked>
                                <span data-i18n="stat_mean">mean</span>
                            </label>
                        </div>
                        <div class="option-group two-col">
                            <label class="checkbox-label">
                                <input id="stats-show-median" type="checkbox" checked>
                                <span data-i18n="stat_median">median</span>
                            </label>
                            <label class="checkbox-label">
                                <input id="stats-show-sd" type="checkbox" checked>
                                <span data-i18n="stat_sd">sd</span>
                            </label>
                        </div>
                        <div class="option-group">
                            <label class="checkbox-label">
                                <input id="stats-show-iqr" type="checkbox" checked>
                                <span data-i18n="stat_iqr">iqr</span>
                            </label>
                        </div>
                    </div>
                    <div class="option-group">
                        <label class="option-label" data-i18n="stats_position">Stats position</label>
                        <select id="stats-position" class="select-input">
                            <option value="top_right" data-i18n="top_right">Top right</option>
                            <option value="top_left" data-i18n="top_left">Top left</option>
                            <option value="bottom_right" data-i18n="bottom_right">Bottom right</option>
                            <option value="bottom_left" data-i18n="bottom_left">Bottom left</option>
                        </select>
                    </div>
                </details>
                <details class="settings-section">
                    <summary data-i18n="anno_group_groupcenter">Group Center Marker</summary>
                    <div class="option-group">
                        <label class="checkbox-label">
                            <input id="show-group-marker" type="checkbox">
                            <span data-i18n="show_group_marker">Highlight center by group</span>
                        </label>
                    </div>
                    <div class="option-group two-col">
                        <div>
                            <label class="option-label" data-i18n="group_metric">Group metric</label>
                            <select id="group-metric" class="select-input">
                                <option value="median" data-i18n="median">Median</option>
                                <option value="mean" data-i18n="mean">Mean</option>
                            </select>
                        </div>
                        <div>
                            <label class="option-label" data-i18n="group_marker_style">Marker style</label>
                            <select id="group-marker-style" class="select-input">
                                <option value="point" data-i18n="point">Point</option>
                                <option value="square" data-i18n="square">Square</option>
                                <option value="line" data-i18n="line">Line</option>
                            </select>
                        </div>
                    </div>
                    <div class="option-group two-col">
                        <div>
                            <label class="option-label" data-i18n="group_marker_color">Marker color</label>
                            <input id="group-marker-color" type="color" value="#7c3aed" class="number-input">
                        </div>
                        <div>
                            <label class="option-label" data-i18n="group_marker_size">Marker size</label>
                            <input id="group-marker-size" type="number" min="2" max="20" step="1" value="5" class="number-input">
                        </div>
                    </div>
                </details>
                <details class="settings-section">
                    <summary data-i18n="anno_group_text">Custom Text</summary>
                    <div class="option-group">
                        <label class="option-label" data-i18n="annotation_text">Annotation text</label>
                        <input id="annotation-text" class="text-input" placeholder="p < 0.05, t-test">
                    </div>
                    <div class="option-group two-col">
                        <div>
                            <label class="option-label" data-i18n="annotation_x">Text X (%)</label>
                            <input id="annotation-x" type="number" min="0" max="100" step="1" value="80" class="number-input">
                        </div>
                        <div>
                            <label class="option-label" data-i18n="annotation_y">Text Y (%)</label>
                            <input id="annotation-y" type="number" min="0" max="100" step="1" value="12" class="number-input">
                        </div>
                    </div>
                    <div class="option-group two-col">
                        <div>
                            <label class="option-label" data-i18n="annotation_color">Text color</label>
                            <input id="annotation-color" type="color" value="#111827" class="number-input">
                        </div>
                        <div>
                            <label class="option-label" data-i18n="annotation_size">Text size</label>
                            <input id="annotation-size" type="number" min="10" max="40" value="13" class="number-input">
                        </div>
                    </div>
                </details>
            </div>

            <div class="options-panel" id="panel-export">
                <h3 class="options-title" data-i18n="panel_export">Export</h3>
                <div class="option-group">
                    <button id="btn-export-png" class="btn-primary btn-block">
                        <i class="ph ph-download-simple"></i> PNG
                    </button>
                </div>
                <div class="option-group">
                    <button id="btn-export-svg" class="btn-secondary btn-block">
                        <i class="ph ph-file-svg"></i> SVG
                    </button>
                </div>
                <div class="option-group">
                    <button id="btn-export-summary" class="btn-secondary btn-block">
                        <i class="ph ph-file-csv"></i> <span data-i18n="export_summary_csv">Summary CSV</span>
                    </button>
                </div>
                <div class="option-group">
                    <button id="btn-export-config" class="btn-secondary btn-block">
                        <i class="ph ph-file-json"></i> <span data-i18n="export_config_json">Config JSON</span>
                    </button>
                </div>
            </div>
        </aside>
    </div>

    <script src="../data-processor/recuedu-data-lib.js?v=20260212019"></script>
    <script type="module" src="app-dashboard.js?v=20260219007"></script>
</body>
</html>
