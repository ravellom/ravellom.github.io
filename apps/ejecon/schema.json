{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Ejercicios Interactivos Schema v1.0",
  "description": "Esquema para ejercicios educativos interactivos con soporte DUA",
  "type": "object",
  "required": ["resource_metadata", "exercises"],
  "properties": {
    "resource_metadata": {
      "type": "object",
      "description": "Metadatos del recurso educativo",
      "required": ["title", "topic"],
      "properties": {
        "title": {
          "type": "string",
          "description": "Título descriptivo del recurso",
          "examples": ["El Ciclo del Agua", "Verbos en Pasado"]
        },
        "topic": {
          "type": "string",
          "description": "Tema o unidad didáctica",
          "examples": ["Ciencias Naturales", "Lengua - Gramática"]
        }
      }
    },
    "exercises": {
      "type": "array",
      "description": "Lista de ejercicios interactivos",
      "items": {
        "type": "object",
        "required": ["id", "type", "content", "interaction"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Identificador único del ejercicio",
            "pattern": "^ex_[0-9]+_[0-9]+$",
            "examples": ["ex_1738012345_0"]
          },
          "type": {
            "type": "string",
            "description": "Tipo de ejercicio interactivo",
            "enum": [
              "multiple_choice",
              "true_false",
              "fill_gaps",
              "ordering",
              "matching",
              "grouping",
              "short_answer",
              "hotspot",
              "slider"
            ]
          },
          "content": {
            "type": "object",
            "description": "Contenido principal del ejercicio",
            "required": ["prompt_text"],
            "properties": {
              "prompt_text": {
                "type": "string",
                "description": "Enunciado o pregunta del ejercicio",
                "examples": ["¿Cuál es la capital de Francia?"]
              }
            }
          },
          "interaction": {
            "type": "object",
            "description": "Datos de interacción (estructura polimórfica según type)",
            "oneOf": [
              {
                "title": "Multiple Choice / True False",
                "description": "Opciones de selección múltiple o verdadero/falso",
                "required": ["options"],
                "properties": {
                  "options": {
                    "type": "array",
                    "minItems": 2,
                    "items": {
                      "type": "object",
                      "required": ["id", "text", "is_correct"],
                      "properties": {
                        "id": {
                          "type": "string",
                          "examples": ["o1", "o2"]
                        },
                        "text": {
                          "type": "string",
                          "examples": ["París", "Londres"]
                        },
                        "is_correct": {
                          "type": "boolean",
                          "description": "Indica si esta opción es correcta"
                        }
                      }
                    }
                  }
                }
              },
              {
                "title": "Fill Gaps",
                "description": "Rellenar huecos en un texto",
                "required": ["template"],
                "properties": {
                  "template": {
                    "type": "string",
                    "description": "Texto con palabras entre [corchetes] para rellenar",
                    "examples": ["La [fotosíntesis] ocurre en las [hojas]"]
                  },
                  "distractors": {
                    "type": "array",
                    "description": "Palabras incorrectas opcionales",
                    "items": {
                      "type": "string"
                    },
                    "examples": [["raíces", "tallo", "flores"]]
                  }
                }
              },
              {
                "title": "Ordering",
                "description": "Ordenar elementos en secuencia",
                "required": ["sequence"],
                "properties": {
                  "sequence": {
                    "type": "array",
                    "minItems": 3,
                    "items": {
                      "type": "object",
                      "required": ["order", "text"],
                      "properties": {
                        "order": {
                          "type": "integer",
                          "minimum": 1,
                          "description": "Posición correcta en la secuencia"
                        },
                        "text": {
                          "type": "string",
                          "description": "Elemento a ordenar"
                        }
                      }
                    }
                  }
                }
              },
              {
                "title": "Matching",
                "description": "Relacionar parejas (izquierda-derecha)",
                "required": ["pairs"],
                "properties": {
                  "pairs": {
                    "type": "array",
                    "minItems": 3,
                    "items": {
                      "type": "object",
                      "required": ["left", "right"],
                      "properties": {
                        "left": {
                          "type": "string",
                          "description": "Concepto o término",
                          "examples": ["H2O"]
                        },
                        "right": {
                          "type": "string",
                          "description": "Definición o respuesta",
                          "examples": ["Agua"]
                        }
                      }
                    }
                  }
                }
              },
              {
                "title": "Grouping",
                "description": "Clasificar elementos en categorías",
                "required": ["categories", "items"],
                "properties": {
                  "categories": {
                    "type": "array",
                    "description": "Nombres de las categorías",
                    "minItems": 2,
                    "items": {
                      "type": "string"
                    },
                    "examples": [["Vertebrados", "Invertebrados"]]
                  },
                  "items": {
                    "type": "array",
                    "description": "Elementos a clasificar",
                    "minItems": 4,
                    "items": {
                      "type": "object",
                      "required": ["text", "category"],
                      "properties": {
                        "text": {
                          "type": "string",
                          "description": "Elemento a clasificar",
                          "examples": ["Perro"]
                        },
                        "category": {
                          "type": "string",
                          "description": "Categoría correcta (debe estar en categories)",
                          "examples": ["Vertebrados"]
                        }
                      }
                    }
                  }
                }
              },
              {
                "title": "Short Answer",
                "description": "Respuesta corta de texto libre",
                "required": ["expected_answers"],
                "properties": {
                  "expected_answers": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                      "type": "string"
                    },
                    "examples": [["mitocondria", "la mitocondria"]]
                  },
                  "case_sensitive": {
                    "type": "boolean",
                    "default": false
                  },
                  "max_length": {
                    "type": "integer",
                    "minimum": 1,
                    "default": 120
                  }
                }
              },
              {
                "title": "Hotspot",
                "description": "Identificar zonas correctas sobre una imagen",
                "required": ["image_url", "zones"],
                "properties": {
                  "image_url": {
                    "type": "string",
                    "description": "URL de imagen base"
                  },
                  "zones": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                      "type": "object",
                      "required": ["x", "y", "width", "height", "is_correct"],
                      "properties": {
                        "x": { "type": "number", "minimum": 0, "maximum": 100 },
                        "y": { "type": "number", "minimum": 0, "maximum": 100 },
                        "width": { "type": "number", "minimum": 0, "maximum": 100 },
                        "height": { "type": "number", "minimum": 0, "maximum": 100 },
                        "is_correct": { "type": "boolean" }
                      }
                    }
                  }
                }
              },
              {
                "title": "Slider",
                "description": "Respuesta numérica en rango con tolerancia",
                "required": ["min", "max", "correct_value"],
                "properties": {
                  "min": { "type": "number" },
                  "max": { "type": "number" },
                  "correct_value": { "type": "number" },
                  "tolerance": { "type": "number", "minimum": 0, "default": 5 }
                }
              }
            ]
          },
          "scaffolding": {
            "type": "object",
            "description": "Andamiaje pedagógico (DUA)",
            "properties": {
              "hint_1": {
                "type": "string",
                "description": "Pista pedagógica contextual",
                "examples": ["Piensa en la capital más grande de Francia"]
              },
              "explanation": {
                "type": "string",
                "description": "Explicación de la respuesta correcta",
                "examples": ["París es la capital de Francia desde 1789"]
              },
              "learn_more": {
                "type": "string",
                "description": "Contenido ampliado para profundizar (opcional)",
                "examples": ["París tiene más de 2 millones de habitantes..."]
              }
            }
          },
          "status": {
            "type": "string",
            "description": "Estado de revisión del ejercicio",
            "enum": ["review", "approved"],
            "default": "review"
          }
        }
      }
    }
  },
  "examples": [
    {
      "resource_metadata": {
        "title": "El Ciclo del Agua",
        "topic": "Ciencias Naturales"
      },
      "exercises": [
        {
          "id": "ex_1738012345_0",
          "type": "multiple_choice",
          "content": {
            "prompt_text": "¿Qué proceso convierte el agua líquida en vapor?"
          },
          "interaction": {
            "options": [
              { "id": "o1", "text": "Evaporación", "is_correct": true },
              { "id": "o2", "text": "Condensación", "is_correct": false },
              { "id": "o3", "text": "Precipitación", "is_correct": false }
            ]
          },
          "scaffolding": {
            "hint_1": "Piensa en lo que sucede cuando el agua se calienta",
            "explanation": "La evaporación es el proceso por el cual el agua líquida se convierte en vapor de agua debido al calor",
            "learn_more": "La evaporación es crucial en el ciclo del agua. Cuando el sol calienta la superficie del agua en océanos, lagos y ríos, las moléculas de agua ganan energía y escapan a la atmósfera como vapor de agua."
          },
          "status": "approved"
        }
      ]
    }
  ]
}
