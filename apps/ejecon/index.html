<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Constructor de Ejercicios Educativos | RecuEdu Labs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" href="../../assets/css/recuedu.css">
    <link rel="stylesheet" href="../../assets/css/recuedu-topbar.css">
<link rel="stylesheet" href="../../assets/css/app-trust-bar.css">
    <link rel="stylesheet" href="style.css">
</head>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5NTJRD37');</script>
<!-- End Google Tag Manager -->
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5NTJRD37"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
    <!-- RecuEdu Topbar -->
    <div class="recuedu-topbar">
        <div class="topbar-container">
            <a href="../../index.html" class="topbar-brand">
                <i class="fa-solid fa-flask-vial"></i>
                <span>RecuEdu Labs</span>
            </a>
            <div class="topbar-links">
                <a href="../../index.html">
                    <i class="fa-solid fa-home"></i>
                    <span>Inicio</span>
                </a>
                <a href="https://github.com/ravellom" target="_blank">
                    <i class="fa-brands fa-github"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- RecuEdu Labs Navbar (oculto) -->
    <nav class="navbar" style="background: #1a1a1a; padding: 8px 0; border-bottom: 1px solid #333; display: none;">
        <div class="container nav-content" style="max-width: 100%; padding: 0 20px;">
            <a href="../../index.html" class="logo" style="color: white; text-decoration: none; font-size: 0.9rem;">
                <i class="fa-solid fa-flask-vial" style="margin-right: 8px;"></i> RecuEdu Labs
            </a>
        </div>
    </nav>

    <header class="app-header">
        <div class="brand">
            <i class="ph ph-cube-transparent" style="font-size: 1.5rem;"></i>
            <div>
                <h1>Generador de Ejercicios <span class="badge">v1.0</span></h1>
            </div>
        </div>
        <div class="actions">
            <a href="GUIA_USO.md" target="_blank" class="btn btn-outline" title="Guía de uso" style="text-decoration: none;">
                <i class="ph ph-question"></i> Ayuda
            </a>
            <button id="btn-undo" class="btn btn-secondary" disabled title="Deshacer">
                <i class="ph ph-arrow-counter-clockwise"></i> Deshacer
            </button>
            <button id="btn-redo" class="btn btn-secondary" disabled title="Rehacer">
                <i class="ph ph-arrow-clockwise"></i> Rehacer
            </button>
            <button id="btn-export" class="btn btn-primary" disabled aria-label="Exportar JSON">
                <i class="ph ph-download-simple"></i> Exportar JSON
            </button>
            <button id="btn-export-html" class="btn btn-primary" disabled aria-label="Exportar HTML">
                <i class="ph ph-file-html"></i> Exportar HTML
            </button>
        </div>
    </header>

    <main class="workspace">
        <aside class="sidebar">
            <div class="panel">
                <h3><i class="ph ph-magic-wand"></i> Asistente IA</h3>
                <button id="btn-show-prompt" class="btn btn-prompt-action" aria-label="Obtener prompt maestro">
                    <i class="ph ph-chat-circle-text"></i> Obtener Prompt Maestro
                </button>

                <div class="divider"></div>

                <h3><i class="ph ph-magnifying-glass"></i> Buscar y Filtrar</h3>
                <input type="text" id="search-input" class="input-field" placeholder="Buscar por enunciado...">
                <select id="filter-type" class="input-field">
                    <option value="">Todos los tipos</option>
                    <option value="multiple_choice">Elección múltiple</option>
                    <option value="true_false">Verdadero/Falso</option>
                    <option value="fill_gaps">Rellenar huecos</option>
                    <option value="ordering">Ordenar</option>
                    <option value="matching">Relacionar</option>
                    <option value="grouping">Clasificar</option>
                    <option value="short_answer">Respuesta corta</option>
                    <option value="hotspot">Zonas clicables</option>
                    <option value="slider">Escala numérica</option>
                </select>
                
                <div class="divider"></div>
                
                <h3><i class="ph ph-sparkle"></i> Generar con IA (Gemini)</h3>
                <input type="password" id="gemini-api-key" class="input-field" placeholder="API Key de Gemini" style="font-family: monospace; font-size: 0.85rem;">
                <select id="gemini-model-select" class="input-field" style="margin-top: 8px;">
                    <option value="gemini-2.0-flash">Gemini 2.0 Flash (Rápido)</option>
                    <option value="gemini-3-flash-preview">Gemini 3 Flash Preview</option>
                    <option value="gemini-3-pro-preview">Gemini 3 Pro Preview (Más potente)</option>
                </select>
                <textarea id="ai-content-input" class="input-field" placeholder="Pega aquí el contenido sobre el que quieres generar ejercicios (texto, temas, conceptos...)" style="min-height: 100px; margin-top: 8px; resize: vertical;"></textarea>
                <button id="btn-generate-ai" class="btn btn-primary" style="width:100%; margin-top:8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" aria-label="Generar ejercicios con IA">
                    <i class="ph ph-magic-wand"></i> Generar Ejercicios con IA
                </button>
                <p class="helper-text" style="font-size: 0.75rem; color: #64748b; margin-top: 6px;">
                    <i class="ph ph-info"></i> Obtén tu API Key gratuita en <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: #667eea;">Google AI Studio</a>
                </p>
                
                <input type="file" id="file-upload" accept=".json" style="display: none;">
                <button id="btn-upload-trigger" class="btn btn-outline" style="width:100%; margin-bottom:10px; border-style:dashed;" aria-label="Subir archivo JSON">
                    <i class="ph ph-upload-simple"></i> Subir Archivo .JSON
                </button>
                
                <button id="btn-load-example" class="btn btn-outline" style="width:100%; margin-bottom:10px; background: #f0f9ff; border-color: #0284c7;" aria-label="Cargar ejemplo">
                    <i class="ph ph-lightbulb"></i> Cargar Ejemplo
                </button>

                <p class="helper-text">O pega el código JSON aquí:</p>
                <textarea id="json-input" placeholder='{"resource_metadata": {...}, "exercises": [...]}'></textarea>
                
                <div class="button-group">
                    <button id="btn-load" class="btn btn-secondary" aria-label="Procesar texto">
                        <i class="ph ph-arrow-counter-clockwise"></i> Procesar Texto
                    </button>
                    <button id="btn-merge" class="btn btn-outline" title="Añadir ejercicios sin borrar los actuales" aria-label="Fusionar ejercicios">
                        <i class="ph ph-plus-circle"></i> Fusionar
                    </button>
                    <button id="btn-clear-json" class="btn btn-outline" title="Limpiar la caja de texto" aria-label="Limpiar JSON">
                        <i class="ph ph-eraser"></i> Limpiar
                    </button>
                </div>
                <div id="status-msg" class="status-msg" aria-live="polite"></div>
            </div>

            <div class="panel metadata-panel hidden" id="meta-panel">
                <h3>Resumen del Recurso</h3>
                <div class="meta-item">
                    <label for="meta-title">Título:</label>
                    <input type="text" id="meta-title" class="input-field" placeholder="Ej. El Ciclo del Agua">
                </div>
                <div class="meta-item">
                    <label for="meta-topic">Tema:</label>
                    <input type="text" id="meta-topic" class="input-field">
                </div>
                <div class="stat-box">
                    <span>Total Ejercicios:</span> <strong id="count-total" style="font-size:1.2rem;">0</strong>
                </div>
            </div>
        </aside>

        <section class="canvas">
            <div id="welcome-screen" class="empty-state">
                <div class="empty-icon-bg">
                    <i class="ph ph-robot"></i>
                </div>
                <h2>Constructor de Ejercicios</h2>
                <p>Sube un archivo .JSON existente o usa "Obtener Prompt" para crear uno nuevo con IA.</p>
            </div>

            <div id="exercise-list" class="exercise-grid hidden">
                </div>
        </section>
    </main>

    <div id="preview-modal" class="modal-overlay hidden" style="display: none;" role="dialog" aria-labelledby="preview-title" aria-describedby="preview-body">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="preview-title">Vista Previa del Ejercicio</h3>
                <button id="btn-close-preview" class="close-icon" aria-label="Cerrar vista previa"><i class="ph ph-x"></i></button>
            </div>
            <div class="modal-body" id="preview-body">
                <div id="preview-content"></div>
            </div>
        </div>
    </div>

    <div id="prompt-modal" class="modal-overlay hidden" style="display: none;" role="dialog" aria-labelledby="modal-title" aria-describedby="modal-body">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh;">
            <div class="modal-header">
                <h3 id="modal-title"><i class="ph ph-magic-wand"></i> Prompt Maestro para IA</h3>
                <button id="btn-close-modal" class="close-icon" aria-label="Cerrar modal"><i class="ph ph-x"></i></button>
            </div>
            <div class="modal-body" id="modal-body" style="max-height: calc(90vh - 120px); overflow-y: auto;">
                <div style="background: #e0f2fe; border-left: 4px solid #0284c7; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                    <p style="margin: 0; color: #0c4a6e; font-size: 0.9rem;">
                        <i class="ph ph-info"></i> <strong>Cómo usar:</strong> Selecciona todo el texto (Ctrl+A), cópialo (Ctrl+C) y pégalo en ChatGPT, Claude u otra IA. 
                        Reemplaza <code>[PEGAR CONTENIDO AQUÍ]</code> con tu tema.
                    </p>
                </div>
                <div class="code-block-wrapper">
                    <textarea id="prompt-text" readonly></textarea>
                    <button id="btn-copy-prompt" class="btn-copy" aria-label="Seleccionar todo el texto"><i class="ph ph-text-aa"></i> Seleccionar Todo</button>
                </div>
            </div>
        </div>
    </div>

    <script src="../eje-shared/exercise-engine.js"></script>
    <script src="app.js"></script>
    <script src="../../assets/js/app-version.js"></script>
    <script src="../../assets/js/app-trust-bar.js"></script>
    <script>
        const appMeta = (window.RecuEduAppMeta && window.RecuEduAppMeta.ejecon) || {};
        const sharedMeta = (window.RecuEduAppMeta && window.RecuEduAppMeta.shared) || {};
        window.initAppTrustBar({
            appName: "Generador de Ejercicios",
            version: appMeta.version || "v0.0.0",
            updated: appMeta.updated || "2026-02-22",
            locale: document.documentElement.lang || "es",
            termsUrl: "../../assets/legal/terms-short.html",
            dataUrl: "../../assets/legal/data-policy-short.html",
            feedbackUrl: sharedMeta.feedbackUrl || "https://forms.gle/NqZWPNXopq6YHJK7A",
            changelogUrl: appMeta.changelogUrl || "./CHANGELOG.md",
            roadmapUrl: appMeta.roadmapUrl || "./ROADMAP.md"
        });
    </script>
</body>
</html>