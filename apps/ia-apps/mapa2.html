<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Europa - Estudio Bilingüe</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

    <style>
        /* --- ESTRUCTURA GENERAL --- */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* --- CABECERA --- */
        header {
            background: white;
            padding: 10px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
            flex-shrink: 0;
        }

        .header-content h1 { margin: 0; font-size: 1.2rem; color: #333; }
        .header-content p { margin: 2px 0 0; font-size: 0.85rem; color: #666; }

        #reset-btn {
            background-color: #ff6961; /* Rojo pastel */
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }

        #reset-btn:hover { background-color: #e0554d; }

        /* --- CONTENEDOR PRINCIPAL --- */
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* MAPA */
        #map {
            flex: 3;
            height: 100%;
            background-color: #ffffff;
            outline: none;
        }

        /* BARRA LATERAL (LISTA) */
        .sidebar {
            flex: 1;
            background-color: #fff;
            border-left: 1px solid #ddd;
            padding: 20px;
            overflow-y: auto;
            box-shadow: -2px 0 5px rgba(0,0,0,0.05);
            z-index: 999;
        }

        .sidebar h2 {
            margin-top: 0;
            font-size: 1.1rem;
            color: #333;
            border-bottom: 2px solid #ff6961;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        /* Estilo de la lista */
        #country-list {
            list-style: none; /* Quitamos los números por defecto del navegador */
            padding: 0;
            margin: 0;
        }

        #country-list li {
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        /* Estilo para el número de orden */
        .order-number {
            background-color: #ff6961;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .english-name {
            color: #888;
            font-style: italic;
            margin-left: 5px;
            font-size: 0.9em;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- RESPONSIVIDAD --- */
        @media (max-width: 768px) {
            .main-container { flex-direction: column; overflow-y: auto; }
            body { overflow: auto; height: auto; }
            #map { height: 50vh; min-height: 300px; }
            .sidebar { border-left: none; border-top: 1px solid #ddd; height: auto; min-height: 300px; }
        }
    </style>
</head>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5NTJRD37');</script>
<!-- End Google Tag Manager -->
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5NTJRD37"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <header>
        <div class="header-content">
            <h1>Geografía de Europa</h1>
            <p>Selecciona los países en orden.</p>
        </div>
        <button id="reset-btn">Reiniciar Ejercicio</button>
    </header>

    <div class="main-container">
        <div id="map"></div>
        
        <aside class="sidebar">
            <h2>Países Identificados (<span id="count">0</span>)</h2>
            <ul id="country-list">
                <li style="color: #999; list-style: none;">Haz clic en el mapa para empezar</li>
            </ul>
        </aside>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        // --- 1. DICCIONARIO DE TRADUCCIÓN (Inglés -> Español) ---
        // El mapa viene en inglés, aquí hacemos la "magia" para los estudiantes.
        const translations = {
            "Albania": "Albania", "Andorra": "Andorra", "Austria": "Austria",
            "Belarus": "Bielorrusia", "Belgium": "Bélgica", 
            "Bosnia and Herzegovina": "Bosnia y Herzegovina", "Bulgaria": "Bulgaria",
            "Croatia": "Croacia", "Cyprus": "Chipre", "Czech Republic": "República Checa",
            "Denmark": "Dinamarca", "Estonia": "Estonia", "Finland": "Finlandia",
            "France": "Francia", "Germany": "Alemania", "Greece": "Grecia",
            "Hungary": "Hungría", "Iceland": "Islandia", "Ireland": "Irlanda",
            "Italy": "Italia", "Kosovo": "Kosovo", "Latvia": "Letonia",
            "Liechtenstein": "Liechtenstein", "Lithuania": "Lituania",
            "Luxembourg": "Luxemburgo", "Malta": "Malta", "Moldova": "Moldavia",
            "Monaco": "Mónaco", "Montenegro": "Montenegro", "Netherlands": "Países Bajos",
            "North Macedonia": "Macedonia del Norte", "Norway": "Noruega",
            "Poland": "Polonia", "Portugal": "Portugal", "Romania": "Rumanía",
            "Russia": "Rusia", "San Marino": "San Marino", "Serbia": "Serbia",
            "Slovakia": "Eslovaquia", "Slovenia": "Eslovenia", "Spain": "España",
            "Sweden": "Suecia", "Switzerland": "Suiza", "Ukraine": "Ucrania",
            "United Kingdom": "Reino Unido", "Vatican City": "Ciudad del Vaticano"
        };

        // --- 2. CONFIGURACIÓN ---
        const map = L.map('map', {
            center: [53.0, 10.0],
            zoom: 4,
            zoomControl: true,
            attributionControl: false,
            minZoom: 3,
            maxZoom: 7
        });

        const SELECTED_COLOR = '#ff6961'; // Rojo Pastel
        const INITIAL_COLOR = '#cccccc';

        // Usamos un Array para guardar objetos {es: "España", en: "Spain"} en orden
        let selectedCountriesList = [];
        // Usamos un Set solo para verificar duplicados rápidamente
        const selectedCountriesSet = new Set();

        // --- 3. GESTIÓN DE LA LISTA UI ---
        const listElement = document.getElementById('country-list');
        const countElement = document.getElementById('count');

        function updateListUI() {
            listElement.innerHTML = '';
            countElement.textContent = selectedCountriesList.length;

            if (selectedCountriesList.length === 0) {
                listElement.innerHTML = '<li style="color: #999;">Haz clic en el mapa para empezar</li>';
                return;
            }

            // Recorremos la lista en orden de inserción
            selectedCountriesList.forEach((country, index) => {
                const li = document.createElement('li');
                
                // Creamos el HTML: Número + Español + (Inglés)
                li.innerHTML = `
                    <span class="order-number">${index + 1}</span>
                    <span>
                        ${country.es} 
                        <span class="english-name">(${country.en})</span>
                    </span>
                `;
                listElement.appendChild(li);
            });
            
            // Auto-scroll al final de la lista para ver el último añadido
            const sidebar = document.querySelector('.sidebar');
            sidebar.scrollTop = sidebar.scrollHeight;
        }

        // --- 4. ESTILOS GEOJSON ---
        function style(feature) {
            return {
                fillColor: INITIAL_COLOR, weight: 1, opacity: 1,
                color: 'black', fillOpacity: 1
            };
        }

        function highlightFeature(e) {
            var layer = e.target;
            layer.setStyle({ weight: 2, color: '#333' });
            layer.bringToFront();
        }

        function resetHighlight(e) {
            const layer = e.target;
            if (layer.feature.properties.assignedColor) {
                layer.setStyle({
                    weight: 1, color: 'black',
                    fillColor: layer.feature.properties.assignedColor
                });
            } else {
                geojson.resetStyle(layer);
            }
        }

        // --- 5. LÓGICA DE CLIC (TRADUCCIÓN Y ORDEN) ---
        function onCountryClick(e) {
            const layer = e.target;
            
            // Obtener nombre original (Inglés) del GeoJSON
            const englishName = layer.feature.properties.NAME || layer.feature.properties.name || "Unknown";

            // Si ya está marcado, no hacemos nada (o podríamos desmarcar, pero para examen mejor dejarlo fijo)
            if (selectedCountriesSet.has(englishName)) return;

            // Traducir al español
            const spanishName = translations[englishName] || englishName; // Si no hay traducción, usa el inglés

            // Marcar visualmente
            layer.feature.properties.assignedColor = SELECTED_COLOR;
            layer.setStyle({ fillColor: SELECTED_COLOR, fillOpacity: 1 });

            // Añadir a nuestros datos
            selectedCountriesSet.add(englishName);
            selectedCountriesList.push({ es: spanishName, en: englishName });
            
            // Actualizar la lista
            updateListUI();
        }

        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: onCountryClick
            });
        }

        // --- 6. RESETEAR ---
        document.getElementById('reset-btn').addEventListener('click', () => {
            if (!geojson) return;

            geojson.eachLayer((layer) => {
                if (layer.feature && layer.feature.properties) {
                    delete layer.feature.properties.assignedColor;
                }
                geojson.resetStyle(layer);
            });

            selectedCountriesSet.clear();
            selectedCountriesList = [];
            updateListUI();
        });

        // --- 7. CARGA DE DATOS ---
        const geoJsonUrl = 'https://raw.githubusercontent.com/leakyMirror/map-of-europe/master/GeoJSON/europe.geojson';
        let geojson; 

        fetch(geoJsonUrl)
            .then(response => response.json())
            .then(data => {
                geojson = L.geoJson(data, {
                    style: style,
                    onEachFeature: onEachFeature
                }).addTo(map);
                map.fitBounds(geojson.getBounds());
            })
            .catch(error => console.error("Error cargando mapa:", error));

    </script>
</body>
</html>
