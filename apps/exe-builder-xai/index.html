<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Exe Builder XAI | RecuEdu Labs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
    <link rel="stylesheet" href="../../assets/css/recuedu.css">
    <link rel="stylesheet" href="../../assets/css/recuedu-topbar.css">
    <link rel="stylesheet" href="style.css">
</head>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5NTJRD37');</script>
<!-- End Google Tag Manager -->
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5NTJRD37"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
    <div class="recuedu-topbar">
        <div class="topbar-container">
            <a href="../../index.html" class="topbar-brand">
                <i class="fa-solid fa-flask-vial"></i>
                <span>RecuEdu Labs</span>
            </a>
            <div class="topbar-links">
                <a href="../../index.html">
                    <i class="fa-solid fa-home"></i>
                    <span>Inicio</span>
                </a>
                <a href="https://github.com/ravellom" target="_blank" rel="noopener noreferrer">
                    <i class="fa-brands fa-github"></i>
                </a>
            </div>
        </div>
    </div>

    <header class="app-header">
        <div class="app-title-wrap">
            <h1 data-i18n="app.title">Exercise builder with XAI</h1>
            <p data-i18n="app.subtitle">Diseño de ejercicios con explicabilidad</p>
        </div>
        <div class="toolbar">
            <label for="language-select" data-i18n="ui.language">Idioma</label>
            <select id="language-select" class="control-select" aria-label="Seleccionar idioma">
                <option value="es">Español</option>
                <option value="en">English</option>
            </select>
            <a id="help-link" href="help.html" target="_blank" rel="noopener noreferrer" class="btn btn-outline" style="text-decoration:none; padding:6px 10px;">
                <i class="ph ph-question"></i> <span data-i18n="ui.help">Ayuda</span>
            </a>
            <a id="help-evidence-link" href="help-xai-evidencia.html" target="_blank" rel="noopener noreferrer" class="btn btn-outline" style="text-decoration:none; padding:6px 10px;">
                <i class="ph ph-book-open-text"></i> <span data-i18n="ui.xaiFoundations">Fundamentos XAI</span>
            </a>
        </div>
    </header>

    <main class="layout">
        <aside class="panel panel-left">
            <h2 data-i18n="panel.ai">Generación con IA</h2>
            <label class="field-label" for="api-key-input" data-i18n="ui.apiKey">API Key</label>
            <input id="api-key-input" class="text-input" type="password" autocomplete="off" placeholder="AIza...">

            <label class="field-label" for="model-select" data-i18n="ui.model">Modelo</label>
            <select id="model-select" class="control-select" aria-label="Seleccionar modelo">
                <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash-Lite</option>
                <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                <option value="gemini-2.5-flash">Gemini 2.5 Flash (Rápido)</option>
                <option value="gemini-3-flash-preview">Gemini 3 Flash Preview</option>
                <option value="gemini-3-pro-preview">Gemini 3 Pro Preview (Más potente)</option>
            </select>

            <label class="field-label" for="exercise-count" data-i18n="ui.exerciseCount">Cantidad de ejercicios (máx 15)</label>
            <select id="exercise-count" class="control-select" aria-label="Cantidad de ejercicios">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3" selected>3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
            </select>

            <div class="type-plan-box">
                <div class="type-plan-head">
                    <label class="field-label" data-i18n="ui.typePlanTitle">Control por tipo (opcional)</label>
                    <button id="btn-clear-type-plan" type="button" class="btn btn-outline btn-mini" data-i18n="actions.clearTypePlan">Limpiar</button>
                </div>
                <p class="type-plan-help" data-i18n="ui.typePlanHelp">Define cuántos ejercicios quieres por tipo. Si usas este control, la suma reemplaza la cantidad total.</p>
                <div class="type-plan-grid">
                    <label class="type-plan-row"><span data-i18n="types.multiple_choice">Opción múltiple</span><input class="type-qty-input" type="number" min="0" max="15" value="0" data-type="multiple_choice"></label>
                    <label class="type-plan-row"><span data-i18n="types.true_false">Verdadero/Falso</span><input class="type-qty-input" type="number" min="0" max="15" value="0" data-type="true_false"></label>
                    <label class="type-plan-row"><span data-i18n="types.fill_gaps">Completar huecos</span><input class="type-qty-input" type="number" min="0" max="15" value="0" data-type="fill_gaps"></label>
                    <label class="type-plan-row"><span data-i18n="types.ordering">Ordenamiento</span><input class="type-qty-input" type="number" min="0" max="15" value="0" data-type="ordering"></label>
                    <label class="type-plan-row"><span data-i18n="types.matching">Emparejar</span><input class="type-qty-input" type="number" min="0" max="15" value="0" data-type="matching"></label>
                    <label class="type-plan-row"><span data-i18n="types.grouping">Agrupar</span><input class="type-qty-input" type="number" min="0" max="15" value="0" data-type="grouping"></label>
                    <label class="type-plan-row"><span data-i18n="types.short_answer">Respuesta corta</span><input class="type-qty-input" type="number" min="0" max="15" value="0" data-type="short_answer"></label>
                    <label class="type-plan-row"><span data-i18n="types.hotspot">Hotspot</span><input class="type-qty-input" type="number" min="0" max="15" value="0" data-type="hotspot"></label>
                    <label class="type-plan-row"><span data-i18n="types.slider">Slider</span><input class="type-qty-input" type="number" min="0" max="15" value="0" data-type="slider"></label>
                </div>
                <p id="type-plan-total" class="type-plan-total">Total por tipo: 0/15</p>
            </div>

            <label class="field-label" for="content-input" data-i18n="ui.content">Contenido o resumen</label>
            <textarea id="content-input" class="json-input" spellcheck="false" placeholder="Pega aquí el resumen o contenido base para generar el set de ejercicios XAI..."></textarea>

            <input id="summary-file" type="file" accept=".txt,.md,.json,.docx,.doc,.pdf" style="display:none;">
            <div class="panel-actions">
                <button id="btn-upload-summary" class="btn btn-outline" data-i18n="actions.uploadSummary">Subir resumen</button>
                <button id="btn-generate" class="btn btn-primary" data-i18n="actions.generate">Generar con IA</button>
            </div>
            <div class="panel-actions">
                <button id="btn-load-example" class="btn btn-outline" data-i18n="actions.loadExample">Cargar ejemplo</button>
                <button id="btn-validate" class="btn btn-primary" data-i18n="actions.validate">Validar</button>
            </div>
            <input id="project-file" type="file" accept=".json" style="display:none;">
            <div class="panel-actions">
                <button id="btn-import-project" class="btn btn-outline" data-i18n="actions.importProject">Cargar proyecto docente</button>
            </div>
            <div class="panel-actions">
                <button id="btn-export-project" class="btn btn-outline" data-i18n="actions.exportProject">Exportar proyecto docente</button>
                <button id="btn-export-visor" class="btn btn-primary" data-i18n="actions.exportVisor">Exportar para visor</button>
            </div>
            <div id="status-msg" class="status-msg" aria-live="polite"></div>
            <p class="hint" data-i18n="ui.schemaHint">Esquema oficial: schema/xai-exercise-schema.json</p>
        </aside>

        <div id="layout-resizer" class="panel-resizer" aria-hidden="true"></div>

        <section class="panel panel-main">
            <div class="main-tabs" role="tablist" aria-label="Vista principal">
                <button id="tab-btn-plan" class="main-tab-btn active" type="button" role="tab" aria-selected="true" data-target="tab-plan">
                    <i class="ph ph-squares-four"></i> <span data-i18n="panel.explorer">Explorador de ejercicios XAI</span>
                </button>
                <button id="tab-btn-insights" class="main-tab-btn" type="button" role="tab" aria-selected="false" data-target="tab-insights">
                    <i class="ph ph-eye"></i> XAI Insights (¿Por qué?)
                </button>
            </div>

            <section id="tab-plan" class="main-tab-panel active" role="tabpanel">
                <div class="editor-workspace" aria-live="polite">
                    <aside class="exercise-nav">
                        <div class="exercise-nav-head">
                            <h3><i class="ph ph-list-bullets"></i> <span data-i18n="panel.exerciseList">Listado</span></h3>
                            <span id="exercise-count-badge" class="exercise-count-badge">0</span>
                        </div>
                        <input id="exercise-search" class="mini-input" type="text" data-i18n-placeholder="ui.searchExercise" placeholder="Buscar ejercicio...">
                        <ul id="exercise-nav-list" class="exercise-nav-list"></ul>
                    </aside>

                    <div id="editor-resizer" class="subpanel-resizer" aria-hidden="true"></div>

                    <section class="exercise-detail">
                        <div id="exercise-detail-header" class="exercise-detail-header"></div>
                        <div id="exercise-editor" class="exercise-editor"></div>
                    </section>
                </div>

                <details class="json-details">
                    <summary data-i18n="panel.output">JSON XAI generado (técnico)</summary>
                    <textarea id="json-input" class="json-input" spellcheck="false" placeholder="{\n  \"schema_version\": \"xai-exercises/2.0.0\",\n  ...\n}"></textarea>
                </details>

                <h2 data-i18n="panel.results">Resultados de validación</h2>
                <div id="summary-card" class="summary-card" aria-live="polite"></div>
                <details id="prompt-trace-details" class="json-details prompt-trace-details">
                    <summary data-i18n="panel.promptTrace">Prompt final usado (sesión actual)</summary>
                    <pre id="prompt-trace-output" class="prompt-trace-output"></pre>
                </details>
                <div class="result-grid">
                    <div>
                        <h3 class="result-title-row"><span data-i18n="results.errors">Errores</span><span id="errors-badge" class="result-badge">0</span></h3>
                        <ul id="errors-list" class="result-list"></ul>
                    </div>
                    <div>
                        <h3 class="result-title-row"><span data-i18n="results.warnings">Advertencias</span><span id="warnings-badge" class="result-badge warning">0</span></h3>
                        <ul id="warnings-list" class="result-list"></ul>
                    </div>
                </div>
            </section>

            <section id="tab-insights" class="main-tab-panel" role="tabpanel">
                <div class="insights-header">
                    <h2><i class="ph ph-brain"></i> Informe de transparencia</h2>
                    <p>Resumen rápido del estado de calidad, trazabilidad y supervisión humana del set generado.</p>
                </div>

                <div class="insight-kpis">
                    <article class="insight-card">
                        <span class="insight-label">Ejercicios</span>
                        <strong id="insight-kpi-exercises" class="insight-value">0</strong>
                    </article>
                    <article class="insight-card ok">
                        <span class="insight-label">Errores críticos</span>
                        <strong id="insight-kpi-errors" class="insight-value">0</strong>
                    </article>
                    <article class="insight-card warn">
                        <span class="insight-label">Advertencias</span>
                        <strong id="insight-kpi-warnings" class="insight-value">0</strong>
                    </article>
                </div>

                <div class="insight-grid">
                    <article class="insight-block">
                        <h3><i class="ph ph-list-checks"></i> Decisión lógica (rationale)</h3>
                        <p id="insight-rationale">La lógica de diseño se actualizará cuando generes o valides un conjunto de ejercicios.</p>
                    </article>
                    <article class="insight-block">
                        <h3><i class="ph ph-scales"></i> Mitigación de sesgos</h3>
                        <p id="insight-bias">Recomendación: revisar lenguaje inclusivo, diversidad de contextos y accesibilidad en los enunciados.</p>
                    </article>
                    <article class="insight-block">
                        <h3><i class="ph ph-graduation-cap"></i> Alineación pedagógica</h3>
                        <p id="insight-pedagogy">Alinea objetivos, criterios y apoyos diferenciados antes de exportar al visor.</p>
                    </article>
                    <article class="insight-block">
                        <h3><i class="ph ph-shield-check"></i> Estado de cumplimiento</h3>
                        <p id="insight-compliance">Sin datos aún. Genera o valida para estimar cumplimiento técnico inicial.</p>
                    </article>
                </div>

                <div class="human-review-callout">
                    <strong><i class="ph ph-user-circle-gear"></i> Supervisión humana requerida</strong>
                    <p>Antes de publicar o aplicar en aula, revisa precisión disciplinar, adecuación ética y pertinencia para tu contexto educativo.</p>
                </div>
            </section>
        </section>
    </main>

    <script src="../eje-shared/exercise-engine.js"></script>
    <script type="module" src="app.js"></script>
</body>
</html>
