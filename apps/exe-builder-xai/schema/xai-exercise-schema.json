{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Exe Builder XAI Schema v1",
  "description": "Esquema base para sets de ejercicios con bloque de explicabilidad por ejercicio.",
  "type": "object",
  "required": [
    "schema_version",
    "resource_metadata",
    "generation_context",
    "exercises"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "xai-exercises/1.0.0"
    },
    "resource_metadata": {
      "type": "object",
      "required": ["title", "topic", "grade_level", "language"],
      "properties": {
        "title": { "type": "string", "minLength": 3 },
        "topic": { "type": "string", "minLength": 2 },
        "grade_level": { "type": "string", "minLength": 2 },
        "language": { "type": "string", "enum": ["es", "en"] }
      }
    },
    "generation_context": {
      "type": "object",
      "required": ["audience", "pedagogical_goal", "constraints", "source_material_refs"],
      "properties": {
        "audience": { "type": "string", "minLength": 4 },
        "pedagogical_goal": { "type": "string", "minLength": 8 },
        "constraints": {
          "type": "array",
          "items": { "type": "string" }
        },
        "source_material_refs": {
          "type": "array",
          "minItems": 1,
          "items": { "type": "string", "minLength": 3 }
        }
      }
    },
    "exercises": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "type", "content", "interaction", "scaffolding", "xai"],
        "properties": {
          "id": { "type": "string", "minLength": 5 },
          "type": {
            "type": "string",
            "enum": [
              "multiple_choice",
              "true_false",
              "fill_gaps",
              "ordering",
              "matching",
              "grouping",
              "short_answer",
              "hotspot",
              "slider"
            ]
          },
          "content": {
            "type": "object",
            "required": ["prompt_text"],
            "properties": {
              "prompt_text": { "type": "string", "minLength": 8 }
            }
          },
          "interaction": { "type": "object" },
          "scaffolding": {
            "type": "object",
            "required": ["hint_1", "explanation", "learn_more"],
            "properties": {
              "hint_1": { "type": "string", "minLength": 5 },
              "explanation": { "type": "string", "minLength": 10 },
              "learn_more": { "type": "string", "minLength": 8 }
            }
          },
          "xai": {
            "type": "object",
            "required": [
              "why_this_exercise",
              "pedagogical_alignment",
              "content_selection",
              "design_rationale",
              "fairness_and_risk",
              "uncertainty",
              "counterfactual",
              "trace"
            ],
            "properties": {
              "why_this_exercise": { "type": "string", "minLength": 40 },
              "pedagogical_alignment": {
                "type": "object",
                "required": ["learning_objective", "competency", "bloom_level", "difficulty_level"],
                "properties": {
                  "learning_objective": { "type": "string", "minLength": 6 },
                  "competency": { "type": "string", "minLength": 4 },
                  "bloom_level": {
                    "type": "string",
                    "enum": ["recordar", "comprender", "aplicar", "analizar", "evaluar", "crear"]
                  },
                  "difficulty_level": {
                    "type": "string",
                    "enum": ["bajo", "medio", "alto"]
                  }
                }
              },
              "content_selection": {
                "type": "object",
                "required": ["why_this_content", "source_refs", "alternatives_considered"],
                "properties": {
                  "why_this_content": { "type": "string", "minLength": 40 },
                  "source_refs": {
                    "type": "array",
                    "minItems": 1,
                    "items": { "type": "string", "minLength": 3 }
                  },
                  "alternatives_considered": {
                    "type": "array",
                    "items": { "type": "string" }
                  }
                }
              },
              "design_rationale": {
                "type": "object",
                "required": ["why_this_type", "why_this_distractors", "expected_time_sec", "cognitive_load"],
                "properties": {
                  "why_this_type": { "type": "string", "minLength": 10 },
                  "why_this_distractors": { "type": "string", "minLength": 10 },
                  "expected_time_sec": { "type": "integer", "minimum": 10 },
                  "cognitive_load": {
                    "type": "string",
                    "enum": ["baja", "media", "alta"]
                  }
                }
              },
              "fairness_and_risk": {
                "type": "object",
                "required": ["potential_biases", "mitigations"],
                "properties": {
                  "potential_biases": {
                    "type": "array",
                    "items": { "type": "string" }
                  },
                  "mitigations": {
                    "type": "array",
                    "items": { "type": "string" }
                  }
                }
              },
              "uncertainty": {
                "type": "object",
                "required": ["confidence", "limitations"],
                "properties": {
                  "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
                  "limitations": {
                    "type": "array",
                    "minItems": 1,
                    "items": { "type": "string" }
                  }
                }
              },
              "counterfactual": {
                "type": "object",
                "required": ["condition", "expected_change"],
                "properties": {
                  "condition": { "type": "string", "minLength": 5 },
                  "expected_change": { "type": "string", "minLength": 5 }
                }
              },
              "trace": {
                "type": "object",
                "required": ["model", "prompt_id", "timestamp_utc"],
                "properties": {
                  "model": { "type": "string", "minLength": 2 },
                  "prompt_id": { "type": "string", "minLength": 2 },
                  "timestamp_utc": { "type": "string", "format": "date-time" }
                }
              }
            }
          }
        }
      }
    }
  }
}
