:root {
    --xai-border: #dbe2ea;
    --xai-text: #0f172a;
    --xai-muted: #475569;
    --xai-bg: #f8fafc;
    --xai-card: #ffffff;
    --xai-primary: #2563eb;
    --xai-primary-dark: #1d4ed8;
    --xai-success: #166534;
    --xai-danger: #991b1b;
    --xai-warning: #92400e;
    --xai-shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
    --xai-radius: 14px;
    --xai-radius-sm: 10px;
    --xai-accent-a: #14b8a6;
    --xai-accent-b: #f59e0b;
    --xai-font-base: 14px;
    --xai-font-sm: 0.82rem;
    --xai-font-xs: 0.76rem;
}

* {
    box-sizing: border-box;
}

body {
    margin: 0;
    font-family: "Manrope", "Avenir Next", "Segoe UI", sans-serif;
    font-size: var(--xai-font-base);
    line-height: 1.45;
    color: var(--xai-text);
    background:
        radial-gradient(1200px 500px at 15% -10%, #e8f1ff 0%, transparent 60%),
        radial-gradient(900px 420px at 85% -20%, #f0f5ff 0%, transparent 62%),
        var(--xai-bg);
}

.app-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 16px;
    padding: 8px 14px;
    border-bottom: 1px solid #d7dee8;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(6px);
    box-shadow: 0 4px 14px rgba(15, 23, 42, 0.05);
    position: sticky;
    top: 0;
    z-index: 30;
}

.app-title-wrap {
    display: grid;
    grid-template-columns: 42px 1fr;
    align-items: center;
    column-gap: 10px;
}

.app-brand-mark {
    width: 42px;
    height: 42px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.app-logo-image {
    width: 42px;
    height: 42px;
    border-radius: 12px;
    object-fit: contain;
}

.app-title-wrap.logo-rich {
    grid-template-columns: auto;
    row-gap: 2px;
}

.app-title-wrap.logo-rich .app-brand-mark {
    width: 170px;
    height: auto;
    justify-content: flex-start;
}

.app-title-wrap.logo-rich .app-logo-image {
    width: 170px;
    height: auto;
    border-radius: 0;
}

.app-title-wrap.logo-rich h1 {
    display: none;
}

.app-title-wrap.logo-rich p {
    grid-column: 1;
    margin-top: 1px;
    font-size: 0.8rem;
}

.app-logo-mark {
    width: 38px;
    height: 38px;
    border-radius: 10px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 0.78rem;
    font-weight: 800;
    letter-spacing: 0.06em;
    color: #1d4ed8;
    border: 1px solid #bfdbfe;
    background: linear-gradient(180deg, #eff6ff 0%, #dbeafe 100%);
}

.app-title-wrap h1 {
    margin: 0;
    font-size: 1.32rem;
    letter-spacing: -0.01em;
    grid-column: 2;
}

.app-title-wrap p {
    margin: 3px 0 0;
    color: var(--xai-muted);
    font-size: var(--xai-font-sm);
    grid-column: 2;
}

.toolbar {
    display: flex;
    align-items: center;
    gap: 6px;
    flex-wrap: wrap;
}

.btn-visor-link {
    border-color: #99f6e4;
    color: #0f766e;
    background: linear-gradient(135deg, #ecfeff, #f0fdfa);
}

.btn-visor-link:hover {
    border-color: #5eead4;
    color: #0f766e;
    background: linear-gradient(135deg, #ccfbf1, #e6fffb);
}

.layout {
    --left-panel-width: 430px;
    display: grid;
    grid-template-columns: minmax(320px, var(--left-panel-width)) 8px minmax(0, 1fr);
    gap: 18px;
    padding: 18px;
    align-items: start;
    min-width: 0;
    min-height: 0;
}

.panel {
    background: var(--xai-card);
    border: 1px solid #d8e1ec;
    border-radius: var(--xai-radius);
    padding: 14px;
    box-shadow: 0 10px 20px rgba(15, 23, 42, 0.05);
    position: relative;
}

.panel-main {
    min-width: 0;
    overflow: hidden;
}

.panel::before {
    content: "";
    position: absolute;
    left: 14px;
    right: 14px;
    top: -1px;
    height: 3px;
    border-radius: 999px;
    background: linear-gradient(90deg, var(--xai-primary) 0%, var(--xai-accent-a) 55%, var(--xai-accent-b) 100%);
    opacity: 0.75;
    pointer-events: none;
}

.panel-left {
    position: sticky;
    top: 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    height: calc(100vh - 96px);
    max-height: calc(100vh - 96px);
    min-height: 0;
    overflow-y: scroll !important;
    overflow-x: hidden !important;
    scrollbar-gutter: stable;
    overscroll-behavior: contain;
    -webkit-overflow-scrolling: touch;
    padding-bottom: 82px;
}

.generation-lock-overlay {
    position: absolute;
    inset: 0;
    z-index: 35;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    background: rgba(241, 245, 249, 0.72);
    backdrop-filter: blur(2px);
}

.generation-lock-overlay[hidden] {
    display: none !important;
}

.generation-lock-inner {
    width: min(92%, 340px);
    border: 1px solid #cbd5e1;
    border-radius: 14px;
    padding: 18px 14px;
    background: rgba(255, 255, 255, 0.9);
    box-shadow: 0 12px 24px rgba(15, 23, 42, 0.14);
    text-align: center;
}

.generation-lock-gear {
    font-size: 3.2rem;
    line-height: 1;
    color: #1d4ed8;
    display: inline-block;
    animation: spin-gear 1.35s linear infinite;
}

.generation-lock-message {
    margin: 12px 0 0;
    font-size: 0.84rem;
    font-weight: 700;
    color: #1e293b;
}

.left-header h2 {
    margin: 0;
}

.left-subtitle {
    margin: 6px 0 0;
    font-size: 0.8rem;
    color: var(--xai-muted);
}

.api-key-help-link {
    color: #1d4ed8;
    text-decoration: underline;
    font-weight: 600;
}

.left-section-nav {
    display: grid;
    grid-template-columns: repeat(6, minmax(0, 1fr));
    gap: 6px;
}

.left-section-nav .left-nav-link {
    grid-column: span 2;
}

.left-section-nav .left-nav-link:nth-child(4) {
    grid-column: 2 / span 2;
}

.left-section-nav .left-nav-link:nth-child(5) {
    grid-column: 4 / span 2;
}

.left-nav-link {
    appearance: none;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    border: 1px solid var(--xai-border);
    border-radius: 999px;
    padding: 5px 8px;
    text-decoration: none;
    color: var(--xai-muted);
    font-size: 0.74rem;
    font-weight: 700;
    background: #fff;
    cursor: pointer;
}

.left-nav-link:hover {
    border-color: #bfdbfe;
    color: #1d4ed8;
    background: #eff6ff;
}

.left-nav-link.active {
    border-color: #93c5fd;
    color: #1d4ed8;
    background: #dbeafe;
}

.control-group-panel {
    border: 1px solid var(--xai-border);
    border-radius: var(--xai-radius-sm);
    background: #fff;
    overflow: visible;
    display: none;
    margin-top: 8px;
}

.control-group-panel.active {
    display: block;
    max-height: none;
    overflow: visible;
}

.control-group-title {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px;
    font-size: 0.84rem;
    font-weight: 700;
    color: #1e293b;
    border-bottom: 1px solid var(--xai-border);
    background: #f8fbff;
}

.group-step {
    width: 20px;
    height: 20px;
    border-radius: 999px;
    border: 1px solid #bfdbfe;
    color: #1d4ed8;
    background: #eff6ff;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 0.72rem;
    font-weight: 800;
}

.group-body {
    padding: 10px;
}

.dua-config-grid {
    display: grid;
    gap: 8px;
}

.dua-barriers {
    display: grid;
    gap: 6px;
    padding: 8px;
    border: 1px solid var(--xai-border);
    border-radius: 8px;
    background: #fafcff;
    font-size: 0.82rem;
}

.left-action-bar {
    position: sticky;
    bottom: 0;
    display: grid;
    grid-template-columns: 1fr 1fr 1.3fr;
    gap: 8px;
    padding: 10px 0 2px;
    background: linear-gradient(180deg, rgba(248, 250, 252, 0) 0%, rgba(248, 250, 252, 1) 30%);
    border-top: 1px solid #dde5ef;
}

.panel-resizer,
.subpanel-resizer {
    width: 8px;
    border-radius: 999px;
    cursor: col-resize;
    background: linear-gradient(180deg, #dbeafe, #c7d2fe);
    align-self: stretch;
    border: 1px solid #bfdbfe;
}

.panel-resizer:hover,
.subpanel-resizer:hover {
    background: linear-gradient(180deg, #bfdbfe, #a5b4fc);
}

.panel h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 1.05rem;
}

.workspace-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    margin-bottom: 12px;
}

.workspace-title {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-weight: 800;
    color: #0f3ea8;
    border: 1px solid #bfdbfe;
    background: linear-gradient(135deg, #eaf1ff, #ecfeff);
    border-radius: 999px;
    padding: 9px 14px;
    font-size: 0.9rem;
}

.workspace-main {
    min-width: 0;
}

.insights-details {
    margin-top: 12px;
}

.main-tab-btn {
    border: 1px solid var(--xai-border);
    border-radius: 999px;
    background: #f8fafc;
    color: var(--xai-muted);
    font-weight: 700;
    font-size: 0.86rem;
    padding: 9px 12px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.main-tab-btn.active {
    color: #0f3ea8;
    background: linear-gradient(135deg, #eaf1ff, #ecfeff);
    border-color: #bfdbfe;
    box-shadow: 0 3px 8px rgba(37, 99, 235, 0.15);
}

.field-label {
    display: block;
    font-size: 0.83rem;
    font-weight: 600;
    margin: 10px 0 6px;
    color: var(--xai-muted);
}

.text-input {
    width: 100%;
    border: 1px solid var(--xai-border);
    border-radius: 10px;
    padding: 9px 10px;
    font-size: 0.9rem;
    transition: border-color 0.18s ease, box-shadow 0.18s ease;
}

.json-input {
    width: 100%;
    min-height: 360px;
    resize: vertical;
    border: 1px solid var(--xai-border);
    border-radius: 10px;
    padding: 12px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    font-size: 0.88rem;
    line-height: 1.45;
}

#content-input {
    min-height: 180px;
}

.panel-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
}

.btn {
    border: 1px solid transparent;
    border-radius: 10px;
    padding: 7px 10px;
    cursor: pointer;
    font-weight: 700;
    font-size: var(--xai-font-sm);
    letter-spacing: 0.01em;
    transition: transform 0.14s ease, box-shadow 0.18s ease, background-color 0.18s ease, border-color 0.18s ease;
}

.btn-primary {
    background: linear-gradient(135deg, var(--xai-primary), var(--xai-primary-dark) 70%, #0ea5e9);
    color: #fff;
    box-shadow: 0 6px 14px rgba(37, 99, 235, 0.28);
}

.btn-outline {
    background: #fdfefe;
    border-color: var(--xai-border);
    color: var(--xai-text);
}

.control-select {
    border: 1px solid var(--xai-border);
    border-radius: 10px;
    padding: 8px 9px;
    transition: border-color 0.18s ease, box-shadow 0.18s ease;
}

.text-input:focus,
.control-select:focus,
.mini-input:focus,
.mini-textarea:focus,
.mini-select:focus,
.json-input:focus,
.type-qty-input:focus {
    outline: none;
    border-color: #93c5fd;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.16);
}

.btn:hover {
    transform: translateY(-1px);
}

.btn:active {
    transform: translateY(0);
}

.btn-outline:hover {
    border-color: #c7d2fe;
    background: #f8faff;
}

.btn-primary:hover {
    box-shadow: 0 8px 16px rgba(37, 99, 235, 0.34);
}

.type-plan-box {
    margin-top: 8px;
    border: 1px solid var(--xai-border);
    border-radius: 10px;
    padding: 10px;
    background: linear-gradient(180deg, #fbfdff 0%, #f8fffe 100%);
}

.manual-ai-panel {
    margin-top: 10px;
    border: 1px dashed var(--xai-border);
    border-radius: 10px;
    padding: 10px;
    background: #f8fbff;
}

#manual-ai-prompt {
    min-height: 140px;
}

#manual-ai-response {
    min-height: 180px;
}

.type-plan-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
}

.btn-mini {
    padding: 3px 7px;
    font-size: var(--xai-font-xs);
}

.type-plan-help {
    margin: 4px 0 8px;
    font-size: 0.79rem;
    color: var(--xai-muted);
}

.teacher-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 8px;
}

@media (max-width: 900px) {
    .teacher-grid {
        grid-template-columns: 1fr;
    }
}

.type-plan-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 6px;
}

.type-plan-row {
    display: grid;
    grid-template-columns: 1fr 64px;
    align-items: center;
    gap: 8px;
    font-size: 0.84rem;
    color: var(--xai-text);
}

.type-qty-input {
    width: 100%;
    border: 1px solid var(--xai-border);
    border-radius: 8px;
    padding: 5px 6px;
    font-size: 0.84rem;
}

.type-plan-total {
    margin: 8px 0 0;
    font-size: 0.82rem;
    color: var(--xai-muted);
}

.type-plan-total.over {
    color: var(--xai-danger);
    font-weight: 700;
}

.hint {
    margin: 10px 0 0;
    color: var(--xai-muted);
    font-size: 0.82rem;
}

.status-msg {
    margin-top: 2px;
    border-radius: 8px;
    border: 1px solid var(--xai-border);
    padding: 8px 10px;
    font-size: 0.84rem;
    min-height: 38px;
    color: var(--xai-muted);
    background: #fff;
}

.status-msg.info {
    color: #1e3a8a;
    background: linear-gradient(90deg, #eff6ff, #f0f9ff);
}

.status-msg.success {
    color: var(--xai-success);
    background: #f0fdf4;
}

.status-msg.error {
    color: var(--xai-danger);
    background: #fef2f2;
}

.status-msg.warning {
    color: var(--xai-warning);
    background: #fffbeb;
}

.exercise-editor {
    display: block;
    min-width: 0;
}

.editor-workspace {
    --exercise-nav-width: 300px;
    display: grid;
    grid-template-columns: minmax(220px, var(--exercise-nav-width)) 8px minmax(0, 1fr);
    gap: 12px;
    margin-bottom: 12px;
    min-width: 0;
}

.exercise-nav {
    border: 1px solid var(--xai-border);
    border-radius: 12px;
    padding: 10px;
    background: linear-gradient(180deg, #f7faff 0%, #f0fdfb 70%, #ffffff 100%);
}

.exercise-nav-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    margin-bottom: 8px;
}

.exercise-nav-head h3 {
    margin: 0;
    font-size: 0.9rem;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.exercise-count-badge {
    background: #e0e7ff;
    color: #1e3a8a;
    border: 1px solid #c7d2fe;
    border-radius: 20px;
    padding: 2px 8px;
    font-size: 0.75rem;
    font-weight: 700;
}

.exercise-nav-list {
    list-style: none;
    margin: 10px 0 0;
    padding: 0;
    max-height: 520px;
    overflow: auto;
    display: grid;
    gap: 6px;
}

.exercise-nav-item {
    border: 1px solid var(--xai-border);
    border-radius: 8px;
    background: #fff;
    padding: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.83rem;
    color: var(--xai-text);
    min-width: 0;
}

.exercise-nav-item.pending {
    background: #fff7ed;
    border-color: #fed7aa;
}

.exercise-nav-item.reviewed {
    background: #ecfdf5;
    border-color: #86efac;
}

.exercise-nav-item:hover {
    border-color: #c7d2fe;
    background: #f8faff;
}

.exercise-nav-item.active {
    border-color: #60a5fa;
    background: linear-gradient(135deg, #eff6ff, #f0fdfa);
}

.exercise-nav-item.pending.active {
    border-color: #fb923c;
    background: #ffedd5;
}

.exercise-nav-item.reviewed.active {
    border-color: #22c55e;
    background: #dcfce7;
}

.exercise-nav-item .type {
    color: var(--xai-muted);
    font-size: 0.75rem;
    overflow-wrap: anywhere;
}

.exercise-core-header {
    list-style: none;
    font-size: 0.72rem;
    font-weight: 800;
    color: #64748b;
    margin: 8px 2px 4px;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
}

.core-insights-link {
    appearance: none;
    border: 1px solid #bfdbfe;
    border-radius: 999px;
    background: #eff6ff;
    color: #1d4ed8;
    font-size: 0.72rem;
    font-weight: 700;
    padding: 3px 8px;
    cursor: pointer;
    text-transform: none;
    letter-spacing: 0;
}

.core-insights-link:hover {
    background: #dbeafe;
    border-color: #93c5fd;
}

html[data-workspace-mode="basic"] .core-insights-link {
    display: none;
}

.variant-pill {
    margin-left: auto;
    border: 1px solid #bfdbfe;
    background: #eff6ff;
    color: #1d4ed8;
    border-radius: 999px;
    font-size: 0.68rem;
    font-weight: 700;
    padding: 2px 7px;
}

.review-badge {
    margin-top: 2px;
    font-size: 0.72rem;
    font-weight: 700;
}

.exercise-nav-item.pending .review-badge {
    color: #c2410c;
}

.exercise-nav-item.reviewed .review-badge {
    color: #166534;
}

.exercise-detail-tools {
    flex-wrap: wrap;
    justify-content: flex-end;
}

.btn-danger-soft {
    border-color: #fecaca;
    color: #b91c1c;
    background: #fff1f2;
}

.btn-danger-soft:hover {
    border-color: #fca5a5;
    background: #ffe4e6;
}

.exercise-detail {
    border: 1px solid var(--xai-border);
    border-radius: 10px;
    padding: 10px;
    background: #fff;
    min-width: 0;
    max-width: 100%;
    overflow-x: auto;
}

.exercise-detail-header {
    border-bottom: 1px solid var(--xai-border);
    margin-bottom: 10px;
    padding-bottom: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    flex-wrap: wrap;
    min-width: 0;
}

.exercise-detail-header h3 {
    margin: 0;
    font-size: 0.95rem;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    overflow-wrap: anywhere;
    min-width: 0;
}

.section-block {
    border: 1px solid var(--xai-border);
    border-radius: 8px;
    padding: 8px;
    margin-bottom: 8px;
    background: linear-gradient(180deg, #ffffff 0%, #f8fbff 74%, #f0fdfa 100%);
    min-width: 0;
}

.section-block h4 {
    margin: 0 0 6px;
    font-size: 0.8rem;
    color: #1e3a8a;
    display: inline-flex;
    align-items: center;
    gap: 5px;
}

.section-core h4 { color: #1d4ed8; }
.section-pedagogical h4 { color: #0f766e; }
.section-xai h4 { color: #7c3aed; }
.section-control h4 { color: #b45309; }
.section-interaction h4 { color: #0369a1; }
.section-preview h4 { color: #4338ca; }
.section-exercise-design h4 { color: #0f172a; }
.section-invariant-matrix h4 { color: #0f766e; }

.exercise-design-stack {
    display: grid;
    gap: 8px;
}

.exercise-tabs-shell {
    display: grid;
    gap: 8px;
}

.exercise-tabs-nav {
    display: flex;
    flex-wrap: nowrap;
    gap: 6px;
    overflow-x: auto;
    padding-bottom: 2px;
}

.exercise-tab-btn {
    border: 1px solid var(--xai-border);
    border-radius: 999px;
    background: #fff;
    color: #334155;
    font-size: 0.78rem;
    font-weight: 700;
    padding: 7px 10px;
    cursor: pointer;
    white-space: nowrap;
    flex: 0 0 auto;
}

.exercise-tab-btn:hover {
    border-color: #bfdbfe;
    color: #1d4ed8;
    background: #eff6ff;
}

.exercise-tab-btn.active {
    border-color: #93c5fd;
    color: #1d4ed8;
    background: #dbeafe;
}

.exercise-tab-panel {
    display: block;
    overflow-wrap: anywhere;
    max-width: 100%;
}

.exercise-tab-panel[hidden] {
    display: none !important;
}

.exercise-validation-panel {
    border: 1px solid #fecaca;
    border-radius: 10px;
    background: #fff7f7;
    padding: 10px;
    display: grid;
    gap: 8px;
}

.exercise-validation-ok {
    margin: 0;
    color: #166534;
    font-weight: 700;
}

.exercise-validation-summary {
    margin: 0;
    color: #991b1b;
    font-weight: 700;
}

.exercise-validation-list {
    margin: 0;
    padding-left: 18px;
    display: grid;
    gap: 3px;
    color: #7f1d1d;
    font-size: 0.8rem;
}

.variant-switcher {
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 6px;
}

.variant-chip {
    border: 1px solid var(--xai-border);
    border-radius: 999px;
    background: #fff;
    color: #334155;
    font-size: 0.72rem;
    font-weight: 700;
    padding: 4px 8px;
    cursor: pointer;
}

.variant-chip.active {
    border-color: #93c5fd;
    background: #dbeafe;
    color: #1d4ed8;
}

.invariants-table-wrap {
    overflow-x: auto;
}

.invariants-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 640px;
    font-size: 0.78rem;
}

.invariants-table th,
.invariants-table td {
    border: 1px solid var(--xai-border);
    padding: 6px 8px;
    text-align: left;
    vertical-align: top;
}

.invariants-table th {
    background: #eff6ff;
    color: #1e3a8a;
    font-weight: 700;
}

.matrix-status {
    display: inline-flex;
    align-items: center;
    border-radius: 999px;
    padding: 2px 8px;
    border: 1px solid transparent;
    font-size: 0.72rem;
    font-weight: 700;
}

.matrix-status.ok {
    background: #ecfdf5;
    color: #166534;
    border-color: #86efac;
}

.matrix-status.warn {
    background: #fff7ed;
    color: #9a3412;
    border-color: #fdba74;
}

.fillgaps-map {
    border: 1px dashed #93c5fd;
    border-radius: 8px;
    padding: 10px;
    background: #eff6ff;
}

.fillgaps-map-title {
    font-size: 0.82rem;
    font-weight: 700;
    color: #1e3a8a;
    margin-bottom: 6px;
}

.fillgaps-map-empty {
    font-size: 0.78rem;
    color: #64748b;
}

.fillgaps-map-list {
    margin: 0;
    padding-left: 18px;
    display: grid;
    gap: 3px;
}

.fillgaps-map-list li {
    font-size: 0.8rem;
    color: #0f172a;
}

.option-edit-list {
    display: grid;
    gap: 8px;
}

.option-edit-row {
    display: grid;
    grid-template-columns: 1fr auto auto;
    gap: 8px;
    align-items: center;
    background: #fff;
    border: 1px solid var(--xai-border);
    border-radius: 8px;
    padding: 8px;
}

.ordering-edit-row {
    grid-template-columns: 1fr 84px auto;
}

.ordering-order-input {
    text-align: center;
    font-weight: 700;
}

.option-edit-actions {
    display: inline-flex;
    gap: 6px;
}

.preview-shell {
    border: 1px solid #c7d2fe;
    border-radius: 10px;
    padding: 10px;
    background: linear-gradient(180deg, #f8faff 0%, #ffffff 100%);
    overflow: auto;
}

.preview-shell .question-text {
    font-size: 1.05rem;
    line-height: 1.5;
    margin-bottom: 12px;
}

.preview-shell .options-grid {
    display: grid;
    gap: 10px;
}

.preview-shell .option-btn {
    width: 100%;
    background: #fff;
    border: 1px solid var(--xai-border);
    border-radius: 10px;
    padding: 12px;
    text-align: left;
    cursor: pointer;
    font-size: 0.95rem;
}

.preview-shell .option-btn.selected {
    border-color: var(--xai-primary);
    box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.18);
    background: #eff6ff;
}

.preview-shell .sortable-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: grid;
    gap: 8px;
}

.preview-shell .sortable-item {
    background: #fff;
    border: 1px solid var(--xai-border);
    border-radius: 10px;
    padding: 10px;
    display: flex;
    gap: 8px;
    cursor: grab;
}

.preview-shell .sortable-item.dragging {
    opacity: 0.55;
}

.preview-shell .matching-grid {
    display: grid;
    grid-template-columns: 1fr 32px 1fr;
    gap: 8px;
    align-items: stretch;
}

.preview-shell .static-list,
.preview-shell .draggable-list {
    display: grid;
    gap: 8px;
}

.preview-shell .static-item,
.preview-shell .draggable-item {
    border: 1px solid var(--xai-border);
    border-radius: 10px;
    padding: 10px;
    background: #fff;
    min-height: 58px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-size: 0.9rem;
}

.preview-shell .draggable-item {
    cursor: grab;
    border-color: #93c5fd;
    background: #f8fbff;
}

.preview-shell .draggable-item.dragging {
    opacity: 0.55;
}

.preview-shell .grouping-area {
    display: grid;
    gap: 12px;
}

.preview-shell .items-pool {
    border: 1px dashed var(--xai-border);
    border-radius: 10px;
    padding: 10px;
    min-height: 70px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    background: #f8fbff;
}

.preview-shell .buckets-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 10px;
}

.preview-shell .bucket {
    border: 1px solid var(--xai-border);
    border-radius: 10px;
    overflow: hidden;
    background: #fff;
}

.preview-shell .bucket-header {
    background: #eff6ff;
    border-bottom: 1px solid #dbeafe;
    padding: 8px;
    font-size: 0.82rem;
    font-weight: 700;
    text-align: center;
}

.preview-shell .bucket-dropzone {
    min-height: 90px;
    padding: 8px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.preview-shell .group-item {
    border: 1px solid #bfdbfe;
    border-radius: 999px;
    padding: 6px 10px;
    background: #fff;
    font-size: 0.82rem;
    cursor: grab;
}

.preview-shell .group-item.selected {
    border-color: var(--xai-primary);
    box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.18);
}

.preview-shell .arrows-column {
    display: grid;
    place-items: center;
    color: var(--xai-muted);
}

.preview-shell .cloze-text {
    line-height: 2;
    border: 1px solid #dbeafe;
    border-radius: 10px;
    padding: 12px;
    background: #f8fbff;
}

.preview-shell .cloze-bank {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.preview-shell .cloze-token {
    border: 1px solid var(--xai-border);
    border-radius: 999px;
    padding: 6px 12px;
    background: #fff;
    cursor: grab;
}

.preview-shell .cloze-token.selected {
    border-color: var(--xai-primary);
    box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.18);
}

.preview-shell .cloze-drop.drag-over {
    box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
}

.exercise-card {
    padding: 0;
}

.section-executive {
    border-color: #bfdbfe;
    background: #f8fbff;
}

.section-narrative {
    border-color: #c7d2fe;
    background: #f9faff;
}

.executive-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 8px;
}

.executive-item {
    border: 1px solid #dbe7ff;
    border-radius: 8px;
    padding: 8px;
    background: #fff;
    display: grid;
    gap: 4px;
}

.executive-item span {
    font-size: 0.75rem;
    color: var(--xai-muted);
}

.executive-item strong {
    font-size: 0.82rem;
    color: var(--xai-text);
    overflow-wrap: anywhere;
}

.confidence-widget {
    margin-top: 8px;
    display: grid;
    gap: 6px;
    font-size: 0.78rem;
    color: var(--xai-muted);
}

.confidence-track {
    width: 100%;
    height: 10px;
    border-radius: 999px;
    border: 1px solid #dbe2ea;
    background: #edf2f7;
    overflow: hidden;
}

.confidence-fill {
    height: 100%;
    background: linear-gradient(90deg, #60a5fa 0%, #2563eb 100%);
}

.xai-narrative {
    margin: 0;
    border: 1px solid #dbe2ea;
    border-radius: 8px;
    padding: 10px;
    background: #fff;
    color: #334155;
    font-size: 0.85rem;
    line-height: 1.55;
    overflow-wrap: anywhere;
}

.technical-details {
    margin-top: 8px;
    border: 1px solid var(--xai-border);
    border-radius: 10px;
    background: #fff;
    padding: 8px;
    max-width: 100%;
    overflow-x: auto;
}

.technical-title {
    margin: 0 0 8px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 0.88rem;
    color: #1e293b;
}

.technical-trace {
    border: 1px solid #dbe2ea;
    border-radius: 8px;
    padding: 8px;
    margin-bottom: 8px;
    background: #f8fafc;
}

.technical-trace p {
    margin: 6px 0 0;
    font-size: 0.78rem;
    color: #475569;
}

.technical-json {
    margin: 6px 0 0;
    border: 1px solid #dbe2ea;
    border-radius: 8px;
    padding: 8px;
    max-height: 260px;
    overflow: auto;
    background: #f8fafc;
    font-size: 0.76rem;
    line-height: 1.4;
}

.technical-groups {
    display: grid;
    gap: 10px;
    margin-bottom: 8px;
}

.technical-group-card {
    margin-bottom: 0;
}

.technical-group-title {
    margin: 0;
    font-size: 0.84rem;
}

.technical-group-hint {
    margin: 4px 0 8px;
    color: var(--xai-muted);
    font-size: 0.72rem;
}

.technical-readable-box {
    border: 1px solid var(--xai-border);
    border-radius: 8px;
    padding: 10px 12px;
    background: #fff;
}

.technical-readable-line {
    margin: 0 0 6px;
    color: #334155;
    font-size: 0.8rem;
    line-height: 1.42;
}

.technical-readable-line:last-child {
    margin-bottom: 0;
}

@keyframes spin-gear {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.exercise-card-head {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
}

.exercise-title {
    margin: 0;
    font-size: 0.95rem;
}

.exercise-type {
    font-size: 0.76rem;
    color: var(--xai-muted);
    border: 1px solid var(--xai-border);
    border-radius: 20px;
    padding: 2px 8px;
}

.exercise-grid {
    display: grid;
    grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
    gap: 8px;
}

.exercise-grid > * {
    min-width: 0;
}

.exercise-grid .field-full {
    grid-column: 1 / -1;
}

/* Prevent horizontal overflow in dense technical sections */
.section-pedagogical .exercise-grid,
.section-xai .exercise-grid,
.section-control .exercise-grid {
    grid-template-columns: 1fr;
}

.mini-label {
    display: block;
    font-size: 0.75rem;
    color: var(--xai-muted);
    margin-bottom: 4px;
}

.mini-input,
.mini-textarea,
.mini-select {
    width: 100%;
    border: 1px solid var(--xai-border);
    border-radius: 8px;
    padding: 7px 8px;
    font-size: 0.82rem;
}

.mini-textarea {
    min-height: 96px;
    resize: vertical;
}

.json-details {
    margin-bottom: 12px;
    border: 1px solid var(--xai-border);
    border-radius: 10px;
    padding: 8px;
    background: #fff;
}

.json-details > summary {
    cursor: pointer;
    font-weight: 600;
    color: var(--xai-muted);
    margin-bottom: 8px;
}

.prompt-trace-details {
    margin-bottom: 12px;
}

.prompt-trace-output {
    margin: 0;
    max-height: 260px;
    overflow: auto;
    padding: 10px;
    border: 1px solid var(--xai-border);
    border-radius: 8px;
    background: #f8fafc;
    white-space: pre-wrap;
    word-break: break-word;
    font-size: 0.8rem;
    line-height: 1.4;
}

.summary-card {
    border: 1px solid var(--xai-border);
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 12px;
    background: #f8fafc;
}

.summary-ok {
    border-color: #bbf7d0;
    background: #f0fdf4;
    color: var(--xai-success);
}

.summary-fail {
    border-color: #fecaca;
    background: #fef2f2;
    color: var(--xai-danger);
}

.result-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}

.result-grid h3 {
    margin: 0 0 8px;
    font-size: 0.95rem;
}

.result-title-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
}

.result-badge {
    display: inline-flex;
    min-width: 26px;
    height: 22px;
    padding: 0 8px;
    border-radius: 999px;
    background: #fee2e2;
    color: #b91c1c;
    border: 1px solid #fecaca;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 700;
}

.result-badge.warning {
    background: #fef3c7;
    color: #92400e;
    border-color: #fde68a;
}

.insights-header h2 {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 6px;
}

.insights-header p {
    margin: 0 0 12px;
    color: var(--xai-muted);
}

.insight-kpis {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 10px;
    margin-bottom: 12px;
}

.insight-card {
    border: 1px solid var(--xai-border);
    border-radius: 10px;
    padding: 10px;
    background: linear-gradient(180deg, #ffffff 0%, #f8fbff 70%, #f0fdfa 100%);
}

.insight-card.ok {
    border-color: #bbf7d0;
    background: #f0fdf4;
}

.insight-card.warn {
    border-color: #fde68a;
    background: #fffbeb;
}

.insight-label {
    display: block;
    color: var(--xai-muted);
    font-size: 0.78rem;
    margin-bottom: 4px;
}

.insight-value {
    font-size: 1.45rem;
    line-height: 1;
}

.insight-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 12px;
}

.insight-block {
    border: 1px solid var(--xai-border);
    border-radius: 10px;
    padding: 10px;
    background: #fff;
}

.insight-block h3 {
    margin: 0 0 6px;
    font-size: 0.88rem;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.insight-block p {
    margin: 0;
    color: var(--xai-muted);
    font-size: 0.84rem;
    line-height: 1.45;
}

.human-review-callout {
    border: 1px solid #fde68a;
    border-radius: 10px;
    padding: 11px 12px;
    background: #fffbeb;
}

.human-review-callout strong {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    color: #92400e;
    font-size: 0.9rem;
}

.human-review-callout p {
    margin: 6px 0 0;
    color: #92400e;
    font-size: 0.84rem;
    line-height: 1.45;
}

.result-list {
    list-style: none;
    margin: 0;
    padding: 0;
    border: 1px solid var(--xai-border);
    border-radius: 8px;
    max-height: 420px;
    overflow: auto;
}

.result-list li {
    border-bottom: 1px solid var(--xai-border);
    padding: 8px 10px;
    font-size: 0.87rem;
    line-height: 1.35;
}

.result-list li:last-child {
    border-bottom: 0;
}

.item-error {
    color: var(--xai-danger);
}

.item-warning {
    color: var(--xai-warning);
}

@media (max-width: 980px) {
    .layout {
        grid-template-columns: 1fr;
        padding: 12px;
    }

    .panel-resizer,
    .subpanel-resizer {
        display: none;
    }

    .panel-left {
        position: static;
        height: 72vh;
        max-height: 72vh;
        min-height: 0;
        overflow-y: scroll !important;
        overflow-x: hidden !important;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 0;
    }

    .control-group-panel.active {
        max-height: none;
    }

    .app-title-wrap.logo-rich .app-brand-mark,
    .app-title-wrap.logo-rich .app-logo-image {
        width: 170px;
    }

    .left-section-nav {
        grid-template-columns: repeat(2, 1fr);
    }

    .left-section-nav .left-nav-link,
    .left-section-nav .left-nav-link:nth-child(4),
    .left-section-nav .left-nav-link:nth-child(5) {
        grid-column: auto;
    }

    .exercise-tabs-nav {
        flex-wrap: wrap;
    }

    .left-action-bar {
        position: static;
        grid-template-columns: 1fr;
        padding-top: 4px;
        background: transparent;
    }

    .editor-workspace {
        grid-template-columns: 1fr;
    }

    .result-grid {
        grid-template-columns: 1fr;
    }

    .workspace-head {
        flex-direction: column;
        align-items: stretch;
    }

    .workspace-title {
        justify-content: center;
    }

    .insight-kpis,
    .insight-grid {
        grid-template-columns: 1fr;
    }

    .executive-grid {
        grid-template-columns: 1fr;
    }

    .exercise-tabs-nav {
        grid-template-columns: 1fr;
    }

    .app-header {
        padding: 8px 10px;
    }
}
